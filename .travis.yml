sudo: required
services:
  - postgresql
  - docker
env:
  global:
    - SHA=$(git rev-parse HEAD)
before_install:
  - psql -c 'create database dwh-test;' -U postgres
  - docker -v
  - docker-compose -v
  - cat /etc/hosts
  - docker-compose -f docker-compose.yml up -d --remove-orphans --build
  - docker ps
  - docker network ls
  - docker network inspect dwh_default
  - docker run -it --env-file .env.ci dwh_migrator mvn exec:java -Dspring.profiles.active=integration-test

script:
  - echo "hello"

deploy:
  provider: script
  script: bash ./deploy.sh
  on:
    branch: master